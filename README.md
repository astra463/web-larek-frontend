# Документация к проекту «Web-larek»

Реализация интернет-магазина «Web-larek. 
- Используемый стек: TypeScript, HTML, SCSS
- Для сборки используется Webpack. 
- Инструменты линтинга и форматирования не подключены.

Архитектура проекта состоит из трёх частей: **Модель** (Model), **представление** (View) и **презентер** (Presenter). 

**Модель**  отвечает за данные, которые используются в приложении. Модель данных обеспечивает единое представление данных в приложении и управляет их состоянием.

**Представление** отвечает за отображение данных пользователю, а также обеспечивает визуальное взаимодействие пользователя с приложением и отображает информацию, полученную из модели данных.

**Презентер** управляет взаимодействием между моделью данных и представлением. Он принимает пользовательский ввод из представления, обрабатывает его и обновляет модель данных, что в свою очередь приводит к изменениям в представлении. 

При инициализации приложения происходит загрузка товаров с сервера с помощью API. Данные помещаются в модель приложения, в свойство `catalog` класса `AppState` и генерируется событие `catalog:changed`. Далее происходит их рендеринг.

Класс `AppState` управляет состоянием всего приложения. Когда цель добавляет товар в корзину, он отправляется в свойство `basket` класса `AppState`. Когда пользователь оформляет заказ, данные заказа также отправляются в соответствующие свойства класса.

<div style="color: darkblue;">
P.S. Для ревьюера <br>
Честно говоря, я не совсем понимаю, как писать интерфейсы, не зная, как будет реализован функционал. То есть сейчас после того, как я написал интерфейс, я начинаю реализовывать, к примеру, добавление товаров на страницу, а затем смотрю, что из методов или свойств забыл указать в интерфейсе. Корректирую и пишу дальше.

В некоторых местах функционал гораздо более сложный, и я не могу просто заняться проектированием, не реализовав логику.

Также я не знаю, верно ли у меня реализован рендеринг карточек товара и других модальных окон, поэтому я решил отправить работу на первый этап ревью сейчас в надежде получить корректировки к работе.
</div>

## Инструкция по сборке и запуску

После клонирования проекта установить зависимости: 

```
npm install
```

Для запуска проекта в режиме разработки выполнить команду: 
```
npm run start 
```

и открыть в браузере страницу по адресу [http://localhost:8080 ](http://localhost:8080)

Для сборки проекта в продакшен выполнить команду:
```
npm run build
``` 

Для данного проекта нет ограничений по использованию пакетного менеджера, поэтому можно использовать также YARN или PNPM.

## Архитектура
здесь будет uml 

## Базовый код

### Класс `Model<T>`

Абстрактный класс `Model` предоставляет базовый функционал для моделей. Он используется для создания моделей данных в приложении. Он имеет следующие свойства и методы:

**Свойства**:

1. `data: Partial<T>` - частичные данные модели, которые могут быть переданы через конструктор при создании экземпляра класса.
2. `events: IEvents` - интерфейс для работы с событиями, предоставляющий методы для эмитирования событий.

**Методы**:

1. `constructor(data: Partial<T>, events: IEvents)` - конструктор класса, принимающий частичные данные модели и объект для работы с событиями. При создании экземпляра класса данные передаются через аргумент data, а объект событий - через аргумент events.
2. `emitChanges(event: string, payload?: object)` - метод, предназначенный для сообщения всем заинтересованным сторонам о том, что модель была изменена. Принимает строку event, представляющую собой название события, и опциональный payload, содержащий данные, связанные с событием. По умолчанию, если payload не передан, используется пустой объект {}.

### Класс `Component <T>`

Класс `Component<T>` является абстрактным базовым классом, предназначенным для работы с DOM элементами в приложениях. Он содержит следующие методы:

**Методы:**

1. **`toggleClass(element: HTMLElement, className: string, force?: boolean): void`**

Переключает класс у указанного элемента. Принимает аргументы:

- `element: HTMLElement` - DOM элемент, класс которого нужно изменить.
- `className: string` - название класса, который нужно переключить.
- `force?: boolean` - опциональный параметр, определяющий, следует ли добавить класс `true` или удалить его `false`. По умолчанию класс будет переключен.

2. **`setText(element: HTMLElement, value: unknown): void`**

Устанавливает текстовое содержимое для указанного элемента. Принимает аргументы:
    
- `element: HTMLElement` - DOM элемент, для которого устанавливается текстовое содержимое.
- `value: unknown` - значение, которое будет установлено в качестве текста элемента.

3. **`setDisabled(element: HTMLElement, state: boolean): void`**
    
Устанавливает состояние блокировки для указанного элемента. Принимает аргументы:

- `element: HTMLElement` - DOM элемент, для которого нужно установить состояние блокировки.
- `state: boolean` - состояние блокировки (true - заблокирован, false - разблокирован).

4. **`setHidden(element: HTMLElement): void`**

Скрывает указанный элемент, устанавливая для него стиль "display: none". Принимает аргументы:

- `element: HTMLElement` - DOM элемент, который нужно скрыть.

5. **`setVisible(element: HTMLElement): void`**
    
Отображает указанный элемент, удаляя стиль "display: none". Принимает аргументы:

- `element: HTMLElement` - DOM элемент, который нужно отобразить.

6. **`setImage(element: HTMLImageElement, src: string, alt?: string): void`**
    
Устанавливает изображение и альтернативный текст для указанного элемента. Принимает аргументы:

- `element: HTMLImageElement` - DOM элемент типа изображения (<img>), для которого нужно установить изображение и альтернативный текст.
- `src: string` - путь к изображению.
- `alt?: string` - опциональный параметр, альтернативный текст для изображения.

7. **`render(data?: Partial<T>): HTMLElement`**
    
Возвращает корневой DOM-элемент компонента. Принимает аргументы:
- `data?: Partial<T>` - частичные данные компонента, которые могут быть переданы при рендеринге.

### Класс EventEmitter

Класс EventEmitter представляет собой инструмент для работы с событиями в приложении. Он обеспечивает следующий функционал:

**Свойства**:

`events: Map<EventName, Set<Subscriber>>` - хранит информацию о зарегистрированных событиях и соответствующих им подписчиках.

**Методы:**

1. `constructor(): void` 

Конструктор класса, инициализирующий пустой список событий.

2. `on<T extends object>(eventName: EventName, callback: (event: T) => void): void` 

Регистрирует обработчик для указанного события. Принимает аргументы `eventName: EventName` - название события, `callback: (event: T) => void` - функция-обработчик, вызываемая при возникновении события. 

3. `off(eventName: EventName, callback: Subscriber): void` 

Снимает регистрацию обработчика с указанного события. Принимает аргументы: `eventName: EventName` - название события. `callback: Subscriber` - обработчик, который нужно удалить.

4. `emit<T extends object>(eventName: string, data?: T): void` 

Генерирует указанное событие и вызывает соответствующие обработчики. Принимает аргументы: `eventName: string` - название события. `data?: T` - данные, передаваемые в обработчики события.

5. `onAll(callback: (event: EmitterEvent) => void): void` 

Регистрирует обработчик для всех событий.

6. `offAll(): void` 

Удаляет все зарегистрированные события и их обработчики.

7. `trigger<T extends object>(eventName: string, context?: Partial<T>): Function` 

Возвращает функцию, которая генерирует указанное событие при вызове. Принимает аргументы: `eventName: string` - название события. `context?: Partial<T>` - дополнительные данные, передаваемые в обработчики события.

### Класс `Api`

Класс `Api` предоставляет удобный интерфейс для выполнения HTTP-запросов к внешнему API. Он содержит следующие методы и свойства:

**Свойства:**

1. `baseUrl: string` - базовый URL для всех запросов к API.
2. `options: RequestInit` - опции запроса, такие как заголовки и другие параметры.

**Методы:**

1. `constructor(baseUrl: string, options: RequestInit = {}): void`

Конструктор класса, инициализирующий базовый URL и опции запроса.Принимает аргументы:

- `baseUrl: string` - базовый URL для всех запросов.
- `options: RequestInit` - дополнительные опции запроса.

2. `protected handleResponse(response: Response): Promise<object>`
    
Обработчик ответа от сервера. Возвращает объект `Promise`, который разрешается с данными ответа или отклоняется с сообщением об ошибке. Принимает аргументы:

- `response: Response` - объект ответа от сервера.

3. `get(uri: string): Promise<object>`
    
Выполняет GET-запрос к указанному URI. Принимает аргументы:

- `uri: string` - дополнительный путь к ресурсу, к которому нужно выполнить запрос.

Возвращает объект Promise, который разрешается с данными ответа или отклоняется с сообщением об ошибке.

4. `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`
    
Выполняет POST-запрос к указанному URI. Принимает аргументы:

- `uri: string` - дополнительный путь к ресурсу, к которому нужно выполнить запрос.
- `data: object` - данные, которые нужно отправить на сервер.
- `method: ApiPostMethods` - метод запроса ('POST' по умолчанию).

Возвращает объект Promise, который разрешается с данными ответа или отклоняется с сообщением об ошибке.

## Компоненты модели данных (бизнес-логика)
### Класс `AppState`

Класс `AppState` расширяет абстрактный класс `Model<IAppState>`, что позволяет ему наследовать базовую функциональность для работы с данными модели и управления событиями. В дополнение к этому классу добавлены следующие свойства и методы:

**Свойства**:

1. `catalog: Product[]` - массив товаров в каталоге магазина.
2. `basket: IBasketState` - состояние корзины с товарами, включая список товаров и общую стоимость.
3. `order: IOrderData & ICustomerData | null` - информация о заказе пользователя, включающая способ оплаты, адрес доставки и данные клиента.

**Методы:**

1. `setCatalog(items: IProduct[])` - метод для установки каталога товаров. Принимает массив товаров `items` типа `IProduct[]`. Внутри метода каждый элемент массива преобразуется в экземпляр класса `Product` и сохраняется в каталоге. После этого генерируется событие об изменении каталога.
    
2. `addToBasket(product: IProduct)` - метод для добавления товара в корзину. Принимает товар `product` типа `IProduct`. Добавляет товар в список товаров корзины и увеличивает общую стоимость корзины на цену товара. Затем генерирует событие об изменении корзины.
    
3. `clearBasket()` - метод для очистки корзины. Очищает список товаров в корзине и устанавливает общую стоимость в 0. Затем генерирует событие об изменении корзины.
    
4. `placeOrder(orderData: IOrderData, customerData: ICustomerData)` - метод для оформления заказа. Принимает данные о заказе `orderData` (способ оплаты и адрес доставки) и данные о покупателе `customerData` (номер телефона и электронная почта). Сохраняет полученные данные в свойство `order` и генерирует событие о размещении заказа.

### Класс `ProductModel`

Класс `ProductModel` является конкретной реализацией абстрактного класса `Model<IProduct>` и предназначен для управления данными о продуктах. Он наследует базовую функциональность от класса `Model<IProduct>` и может содержать дополнительные методы для работы с данными о продуктах.

**Конструктор:**

1. `constructor(data: Partial<IProduct>, events: IEvents): void`

Конструктор класса, принимающий частичные данные о продукте и объект для работы с событиями. При создании экземпляра класса данные передаются через аргумент `data`, а объект событий - через аргумент `events`. Внутри конструктора вызывается конструктор базового класса `Model<IProduct>`, который инициализирует объект с данными и объект для работы с событиями.

### Класс `Product`

Класс Product является конкретной реализацией абстрактного класса `Model<IProduct>` и представляет собой модель продукта в приложении. Он содержит следующие свойства и методы:

**Свойства:**

1. `category: string` - категория продукта.
2. `title: string` - название продукта.
3. `image: string` - URL изображения продукта.
4. `price: number` - цена продукта.
5. `about: string` - описание продукта.

**Методы:**

1. `constructor(data: Partial<IProduct>, events: IEvents): void`

Конструктор класса, принимающий частичные данные о продукте и объект для работы с событиями. При создании экземпляра класса данные передаются через аргумент `data`, а объект событий - через аргумент events. Внутри конструктора вызывается конструктор базового класса `Model<IProduct>`, который инициализирует объект с данными и объект для работы с событиями. Кроме того, значения свойств продукта присваиваются из переданных данных.

### Класс `StoreAPI`

Класс `StoreAPI` представляет собой инструмент для взаимодействия с внешним API магазина и является конкретной реализацией класса Api. Он содержит следующие методы и свойства:

**Свойства:**

1. `cdn: string` - URL контентного хранилища (Content Delivery Network), используемого для хранения изображений продуктов.

**Методы:**

1. `constructor(cdn: string, baseUrl: string, options?: RequestInit): void`

Конструктор класса, принимающий URL контентного хранилища, базовый URL для API магазина и дополнительные опции для настройки запросов. При создании экземпляра класса вызывается конструктор родительского класса Api для инициализации базового URL и опций запроса.

2. `getProductList(): Promise<IProduct[]>`

Метод для получения списка продуктов магазина. Возвращает объект `Promise`, который разрешается массивом объектов продуктов типа `IProduct`. Данные продуктов получаются из ответа API, и каждый объект продукта дополнительно обрабатывается для добавления полного URL изображения из контентного хранилища.

3. `getProductItem(id: string): Promise<IProduct>`
    
Метод для получения информации о конкретном продукте по его идентификатору. Принимает аргумент `id: string` - идентификатор продукта.

Возвращает объект `Promise`, который разрешается объектом продукта типа `IProduct`. Информация о продукте получается из ответа API, и объект продукта дополнительно обрабатывается для добавления полного URL изображения из контентного хранилища.


## Компоненты представления

Элементы интерфейса построены на базе класса `Page`, который в свою очередь наследуется от абстрактного класса `Component<T>`

### Класс `Page`

Класс `Page` является компонентом страницы в приложении и расширяет функциональность абстрактного класса `Component<IPage>`. Он содержит следующие свойства и методы:

**Свойства**:

1. `gallery: HTMLElement` - DOM элемент, представляющий галерею на странице. 
2. `basket: HTMLElement` - DOM элемент, представляющий корзину на странице. 
3. `wrapper: HTMLElement` - DOM элемент, представляющий обёртку страницы

**Методы**:

1. `constructor(container: HTMLElement, events: IEvents): void`
    
Конструктор класса, принимающий контейнер страницы и объект для работы с событиями. Внутри конструктора вызывается конструктор родительского класса `Component<IPage>`, который инициализирует базовый контейнер компонента. Кроме того, в конструкторе инициализируются DOM элементы галереи `_gallery` и корзины `_basket`, а также добавляется обработчик события `"click"` для элемента корзины, который эмитирует событие `"cart:open"`.

2. `set gallery(items: HTMLElement[]): void`
    
Метод для установки элементов в галерею страницы. Принимает массив DOM элементов `items` и заменяет текущие элементы в галерее `gallery` на переданные элементы.

3. `set locked(value: boolean): void`
    
Метод для управления состоянием блокировки страницы. Если значение параметра `value` равно `true`, добавляет класс `"page__wrapper_locked"` к обёртке страницы, что блокирует взаимодействие с содержимым страницы. В противном случае, если значение равно `false`, удаляет этот класс, разблокируя страницу.

### Класс `CatalogItem`

Класс `CatalogItem` является конкретной реализацией класса `Card<ProductCategory>` и представляет собой элемент каталога продуктов. Он содержит следующие свойства и методы:

**Свойства**:

1. `category: HTMLSpanElement` - DOM элемент, представляющий категорию продукта.

**Методы**:

1. `constructor(container: HTMLElement, actions?: ICardActions): void`
    
Конструктор класса, принимающий контейнер, в котором будет создаваться элемент каталога `container`, и дополнительные действия, которые можно применить к элементу карточки `actions`. Внутри конструктора вызывается конструктор родительского класса `Card<ProductCategory>`, который инициализирует базовый контейнер элемента карточки. Кроме того, инициализируется DOM элемент категории продукта `category`.

2. `set category(value: string): void`
    
Метод для установки категории продукта и соответствующего ей стиля категории. Принимает строковое значение категории продукта `value` и устанавливает его текстовое содержимое для элемента `_category`. Также, в зависимости от значения категории, метод применяет соответствующий CSS класс категории, изменяя её стиль.

### Класс `Card<T>`

Класс `Card<T>` представляет собой компонент карточки элемента, который может содержать информацию о различных объектах, таких как продукты, новости и т. д. Он является обобщенной реализацией компонента и может быть использован для отображения различных типов данных. Класс содержит следующие свойства и методы:

**Свойства**:

1. `_title: HTMLElement` - DOM элемент, представляющий заголовок карточки.
2. `_image?: HTMLImageElement` - необязательный DOM элемент, представляющий изображение карточки.
3. `_button?: HTMLButtonElement` - необязательный DOM элемент, представляющий кнопку карточки (если такая имеется).
4. `_about?: HTMLElement` - необязательный DOM элемент, представляющий описание карточки (если такое имеется).
5. `_price: HTMLSpanElement` - DOM элемент, представляющий цену карточки.

**Методы**:

1. `constructor(blockName: string, container: HTMLElement, actions?: ICardActions): void`
    
Конструктор класса, принимающий имя блока `blockName`, контейнер, в котором будет создаваться элемент карточки `container`, и дополнительные действия, которые можно применить к элементу карточки `actions`. Внутри конструктора вызывается конструктор родительского класса `Component<ICard<T>>`, который инициализирует базовый контейнер компонента. Кроме того, в конструкторе инициализируются DOM элементы карточки (заголовок, изображение, кнопка, описание, цена) на основе переданного имени блока.

2. `set id(value: string): void`
    
Метод для установки идентификатора карточки. Принимает строковое значение идентификатора `value` и устанавливает его в атрибут `dataset` контейнера карточки.

3. `get id(): string`
        
Метод для получения идентификатора карточки. Возвращает строковое значение идентификатора из атрибута `dataset` контейнера карточки.

4. `set title(value: string): void`
    
Метод для установки заголовка карточки. Принимает строковое значение заголовка `value` и устанавливает его текстовое содержимое для элемента заголовка `_title`.
    
5. `get title(): string`
    
Метод для получения заголовка карточки. Возвращает текстовое содержимое элемента заголовка `_title`.

6. `set image(value: string): void`
    
Метод для установки изображения карточки. Принимает строковое значение URL изображения `value` и устанавливает его для элемента изображения `_image`, а также использует значение заголовка для атрибута `alt`.

7. `set price(value: string): void`
    
Метод для установки цены карточки. Принимает строковое значение цены `value` и устанавливает его текстовое содержимое для элемента цены `_price`.

8. `set about(value: string | string[]): void`
    
Метод для установки описания карточки. Принимает строку или массив строк `value` и устанавливает его текстовое содержимое для элемента описания `_about`. Если передан массив строк, метод заменяет текущее содержимое элемента описания на элементы с текстом из массива.

### Класс `Modal`

Класс `Modal` представляет модальное окно, которое может быть открыто и закрыто. Он расширяет базовый класс `Component<IModalData>`, который обеспечивает основную функциональность компонентов в приложении. В дополнение к этому классу имеет следующие свойства и методы:

**Свойства**:

1. `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
2. `_content: HTMLElement` - содержимое модального окна.

**Конструктор**:

`constructor(container: HTMLElement, events: IEvents)`

Конструктор принимает в качестве параметров элемент контейнера `container`, куда будет добавлено модальное окно, и объект `events` типа `IEvents`, который предоставляет доступ к системе событий.

**Методы**:

1. `open(): void` - открывает модальное окно. Добавляет класс `modal_active` к контейнеру модального окна и генерирует событие `MODAL_OPENED`.
    
2. `close(): void` - закрывает модальное окно. Удаляет класс `modal_active` из контейнера модального окна, очищает его содержимое и генерирует событие `MODAL_CLOSED`.
    
3. `render(data: IModalData): HTMLElement` - отрисовывает модальное окно на основе данных `data`. Открывает модальное окно после отрисовки и возвращает его контейнер.
    

**Сеттеры**:

1. `content(value: HTMLElement): void` - устанавливает содержимое модального окна. Принимает значение `value` типа `HTMLElement` и заменяет текущее содержимое модального окна на это значение.

### Класс `Basket`

Класс `Basket` представляет модальное окно корзины, которое может быть открыто и закрыто. В дополнение к этому классу имеет следующие свойства и методы:



## Ключевые типы данных

**ProductCategory**: Тип, представляющий категорию продукта. Может принимать значения `'софт-скилл'`, `'другое'`, `'дополнительное'`, `'кнопка'` или `'хард-скилл'`.

**PaymentMethod**: Тип, представляющий способ оплаты. Может быть `'online'` (онлайн оплата) или `'upon-receipt'` (оплата при получении).

**IProduct**: Интерфейс для описания товара. Содержит следующие свойства:
- `category`: тип `ProductCategory` - категория продукта.
- `title`: строка - название товара.
- `image`: строка - ссылка на изображение товара.
- `price`: число - стоимость товара.
- `about`: строка - описание товара.

**ICustomerData**: Интерфейс для описания данных покупателя. Содержит следующие свойства:
- `phoneNumber`: строка - номер телефона покупателя.
- `email`: строка - адрес электронной почты покупателя.

**IOrderData**: Интерфейс для описания данных заказа. Содержит следующие свойства:
- `paymentMethod`: тип `PaymentMethod` - способ оплаты заказа.
- `deliveryAddress`: строка - адрес доставки заказа.

**IBasketState**: Интерфейс для описания состояния корзины. Содержит следующие свойства:
- `items`: массив объектов типа `IProduct` - список товаров в корзине.
- `total`: число - общая стоимость товаров в корзине.

**IAppState**: Интерфейс для описания состояния приложения. Содержит следующие свойства:
- `catalog`: массив объектов типа `IProduct` - список товаров в каталоге магазина.
- `basket`: объект типа `IBasketState` - состояние корзины покупателя.
- `order`: объект типа `IOrderData` & `ICustomerData` | `null` - информация о текущем заказе пользователя.

### Перечисление Events

Перечисление `Events` предоставляет набор событий, используемых в приложении для управления действиями и обмена информацией между компонентами.

**События:**

1. **CATALOG_CHANGED**: Событие, сигнализирующее об изменении элементов каталога товаров.
2. **CARD_SELECTED**: Событие, сообщающее о выборе определенной карточки товара из каталога.
3. **BASKET_CHANGED**: Событие, указывающее на изменение состава или стоимости товаров в корзине покупателя.
4. **BASKET_OPENED**: Событие, вызывающее открытие корзины товаров для просмотра и редактирования.
5. **ORDER_PLACED**: Событие, которое генерируется при размещении нового заказа (когда покупатель перешёл из корзины к оформлению заказа и начал вводить адрес доставки и способ оплаты).
6. **CONTACT_INFO_ENTERED**: Событие, которое генерируется при нажатии покупателем на кнопку после ввода адреса доставки и способа оплаты. Событие сигнализирует том, что нужно открыть форму контактной информации покупателя (номера телефона и электронной почты).
7. **ORDER_SUCCESSFUL**: Событие, которое генерируется при успешном размещении заказа и подтверждении его выполнения. Открывает модальное окно успешного заказа.

Эти события обеспечивают взаимодействие между различными частями приложения, позволяя реагировать на действия пользователя и обновлять интерфейс соответствующим образом.